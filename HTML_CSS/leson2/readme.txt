reduced the code by 50 lines